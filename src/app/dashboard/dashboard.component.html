<div class="container-fluid px-3 px-md-4">
  <!-- Welcome Header -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card shadow-sm border-0">
        <div class="card-body py-4">
          <div class="d-flex flex-column flex-md-row justify-content-between align-items-center">
            <div class="mb-3 mb-md-0">
              <h1 class="h3 mb-2">Welcome, {{currentUser?.firstName}} {{currentUser?.lastName}}!</h1>
              <p class="text-muted mb-0">
                <i class="fas fa-envelope me-1"></i> {{currentUser?.email}}
                <span class="mx-2">â€¢</span>
                <span class="badge bg-primary">{{currentUser?.role || 'Customer'}}</span>
              </p>
            </div>
            <div>
              <button class="btn btn-primary me-2" routerLink="/apply-loan">
                <i class="fas fa-plus me-1"></i> Apply New Loan
              </button>
              <button class="btn btn-outline-secondary" (click)="logout()">
                <i class="fas fa-sign-out-alt me-1"></i> Logout
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="row g-3 mb-4">
    <div class="col-xl-3 col-md-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="text-muted mb-1">Total Loans</h6>
              <h2 class="mb-0 text-primary">{{totalLoans}}</h2>
            </div>
            <div class="bg-primary bg-opacity-10 p-3 rounded-circle">
              <i class="fas fa-file-invoice-dollar fa-2x text-primary"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-xl-3 col-md-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="text-muted mb-1">Approved Loans</h6>
              <h2 class="mb-0 text-success">{{approvedLoans}}</h2>
            </div>
            <div class="bg-success bg-opacity-10 p-3 rounded-circle">
              <i class="fas fa-check-circle fa-2x text-success"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-xl-3 col-md-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="text-muted mb-1">Pending Amount</h6>
              <h3 class="mb-0 text-warning">{{formatCurrency(pendingAmount)}}</h3>
            </div>
            <div class="bg-warning bg-opacity-10 p-3 rounded-circle">
              <i class="fas fa-clock fa-2x text-warning"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-xl-3 col-md-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="text-muted mb-1">Paid Amount</h6>
              <h3 class="mb-0 text-info">{{formatCurrency(paidAmount)}}</h3>
            </div>
            <div class="bg-info bg-opacity-10 p-3 rounded-circle">
              <i class="fas fa-check-double fa-2x text-info"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="row g-4">
    <!-- Loans List -->
    <div class="col-lg-8">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-header bg-white border-0 py-3">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
              <i class="fas fa-list me-2 text-primary"></i>My Loan Applications
            </h5>
            <button class="btn btn-sm btn-outline-primary" (click)="loadMyLoans()" [disabled]="isLoading">
              <i class="fas fa-sync-alt" [class.fa-spin]="isLoading"></i>
            </button>
          </div>
        </div>
        <div class="card-body">
          <!-- Loading State -->
          <div *ngIf="isLoading" class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2 text-muted">Loading your loans...</p>
          </div>

          <!-- Empty State -->
          <div *ngIf="!isLoading && myLoans.length === 0" class="text-center py-5">
            <i class="fas fa-file-invoice-dollar fa-4x text-muted mb-3"></i>
            <h5>No loans yet</h5>
            <p class="text-muted">You haven't applied for any loans yet.</p>
            <button class="btn btn-primary" routerLink="/apply-loan">
              <i class="fas fa-plus me-1"></i> Apply for Your First Loan
            </button>
          </div>

          <!-- Loans List -->
          <div *ngIf="!isLoading && myLoans.length > 0" class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Loan ID</th>
                  <th>Amount</th>
                  <th>Term</th>
                  <th>Interest</th>
                  <th>Status</th>
                  <th>Applied Date</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let loan of myLoans" [routerLink]="['/loan-status', loan.id]" style="cursor: pointer;">
                  <td>#{{loan.id}}</td>
                  <td><strong>{{formatCurrency(loan.principalAmount)}}</strong></td>
                  <td>{{loan.loanTermMonths}} months</td>
                  <td>{{loan.interestRate}}%</td>
                  <td>
                    <span [class]="getStatusBadgeClass(loan.status)">
                      {{loan.status}}
                    </span>
                  </td>
                  <td>{{loan.createdAt | date:'shortDate'}}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="col-lg-4">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-header bg-white border-0 py-3">
          <h5 class="mb-0">
            <i class="fas fa-bolt me-2 text-warning"></i>Quick Actions
          </h5>
        </div>
        <div class="card-body">
          <div class="d-grid gap-3">
            <button class="btn btn-primary py-3" routerLink="/apply-loan">
              <i class="fas fa-file-contract fa-lg me-2"></i>
              <div class="text-start">
                <div class="fw-semibold">Apply for Loan</div>
                <small class="text-white-50">Submit new loan application</small>
              </div>
            </button>

            <button class="btn btn-success py-3" (click)="calculateEMI()">
              <i class="fas fa-calculator fa-lg me-2"></i>
              <div class="text-start">
                <div class="fw-semibold">EMI Calculator</div>
                <small class="text-white-50">Calculate your monthly payments</small>
              </div>
            </button>

            <button class="btn btn-info py-3" (click)="loadMyLoans()" [disabled]="isLoading">
              <i class="fas fa-sync-alt fa-lg me-2"></i>
              <div class="text-start">
                <div class="fw-semibold">Refresh Loans</div>
                <small class="text-white-50">Update loan information</small>
              </div>
            </button>

            <div *ngIf="authService.isAdmin" class="mt-2">
              <div class="alert alert-warning">
                <i class="fas fa-user-shield me-2"></i>
                You have admin privileges
              </div>
            </div>
          </div>

          <!-- EMI Calculator -->
          <div *ngIf="showEMICalculator" class="mt-4 p-3 border rounded">
            <h6 class="mb-3">EMI Calculator</h6>
            
            <!-- EMI Inputs -->
            <div class="mb-3">
              <label class="form-label small">Loan Amount ($)</label>
              <input type="number" class="form-control" [(ngModel)]="emiAmount" min="1000" max="1000000">
            </div>
            <div class="mb-3">
              <label class="form-label small">Interest Rate (%)</label>
              <input type="number" class="form-control" [(ngModel)]="emiRate" min="1" max="30" step="0.1">
            </div>
            <div class="mb-3">
              <label class="form-label small">Term (Months)</label>
              <input type="number" class="form-control" [(ngModel)]="emiMonths" min="6" max="360">
            </div>
            
            <!-- Calculate Button -->
            <button class="btn btn-primary btn-sm w-100 mb-3" (click)="calculateEMINow()" [disabled]="calculatingEMI">
              <span *ngIf="!calculatingEMI">
                <i class="fas fa-calculator me-1"></i> Calculate
              </span>
              <span *ngIf="calculatingEMI">
                <span class="spinner-border spinner-border-sm me-1"></span>
                Calculating...
              </span>
            </button>
            
            <!-- EMI Result -->
            <div *ngIf="emiResult" class="alert alert-info">
              <h6 class="alert-heading">EMI Calculation Result:</h6>
              <div class="row g-2">
                <div class="col-6">
                  <small>Monthly EMI:</small>
                  <div class="fw-bold">{{formatCurrency(emiResult.emi)}}</div>
                </div>
                <div class="col-6">
                  <small>Total Payment:</small>
                  <div class="fw-bold">{{formatCurrency(emiResult.total)}}</div>
                </div>
                <div class="col-12">
                  <small>Total Interest:</small>
                  <div class="fw-bold">{{formatCurrency(emiResult.interest)}}</div>
                </div>
              </div>
            </div>
            
            <!-- Close Button -->
            <button class="btn btn-outline-secondary btn-sm w-100" (click)="closeEMICalculator()">
              <i class="fas fa-times me-1"></i> Close
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>